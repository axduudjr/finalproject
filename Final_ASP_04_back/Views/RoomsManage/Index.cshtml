@model IEnumerable<Final_ASP_04_back.Models.ViewModels.RoomManageVm>

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<div class="container">
    <div class="row">
        <div class="col-12">
            <form method="get">
                <div class="row searchBlock">
                    <div class="form-floating mb-3 col-lg-2">
                        <select class="form-select" name="branchId" id="branchId" placeholder="" readonly aria-label="Floating label select example">
                        </select>
                        <label for="branchId">分館名稱</label>
                    </div>
                    <div class="form-floating mb-3 col-lg-2">
                        <input type="text" name="roomTypeName" class="form-control">
                        <label for="roomName">房型名稱</label>
                    </div>
                    <div class="col-lg-2">
                        <input type="submit" class="btn btn-primary search" id="btnSearch" value="搜尋">
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="container">
    <div class="row row-cols-lg-5 row-cols-md-2">
        @foreach (var item in Model)
        {
            <div class="col">
                <div class="card h-100 text-center roomResult" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@item.Name" data-bs-roomTypeName="@item.RoomTypeName" data-bs-guestNumberCapacity="@item.GuestNumberCapacity" data-bs-description="@item.Description" data-bs-price="@item.Price">
                    <div class="card-body">
                        <h5 class="card-title fw-bolder">@item.Name</h5>
                        <p class="card-text">房型：@item.RoomTypeName</p>
                        <p class="card-text">可容納人數：@item.GuestNumberCapacity</p>
                    </div>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">房號：@item.Name</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <div class="mb-3">
                                <label for="formGroupExampleInput" class="form-label">房型</label>
                                <input type="text" class="form-control" id="recipient-roomTypeName" placeholder="Example input placeholder" value="@item.RoomTypeName">
                            </div>
                            <div class="mb-3">
                                <label for="formGroupExampleInput" class="form-label">可容納人數</label>
                                <input type="text" class="form-control" id="recipient-guestNumberCapacity" placeholder="Example input placeholder">
                            </div>
                            <div class="mb-3">
                                <label for="formGroupExampleInput2" class="form-label">房間細部規格</label>
                                <input type="text" class="form-control" id="recipient-Description" placeholder="Another input placeholder">
                            </div>
                            <div class="mb-3">
                                <label for="formGroupExampleInput2" class="form-label">房間定價</label>
                                <input type="text" class="form-control" id="recipient-Price" placeholder="Another input placeholder">
                            </div>
                            <div class="mb-3">
                                <label for="formGroupExampleInput2" class="form-label">房間狀態</label>
                                <input type="text" class="form-control" id="recipient-Status" placeholder="Another input placeholder">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                        </div>
                    </div>
                </div>
            </div>
            @*<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">房號：@item.Name</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            @Html.Action("RoomDetails", "RoomsManage", new { id = item.Id })
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                        </div>
                    </div>
                </div>
            </div>*@
        }
    </div>
</div>

    @*<table class="table table-striped table-sm">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.RoomTypeName)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.GuestNumberCapacity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th></th>
        </tr>

        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.RoomTypeName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.GuestNumberCapacity)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Price)
                </td>
                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                    @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                    @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                </td>
            </tr>
        }

    </table>*@
    @section css {
    <style>
        .row.searchBlock {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }

        .btn.search {
            margin-top: 8px;
            width: 120px;
        }
        .roomResult:hover{
            cursor: pointer;
            background-color:gainsboro;
        }
    </style>
    }

    @section js {
        <script>
            $(function () {
                initForm();
            })

            function initForm(branchId) {
                var url = "/api/RoomsManageApi/GetBranches";

                fetchJSON(url).then(function (jsonData) {
                    renderSelect(jsonData, "branchId");
                })
            };

            function fetchJSON(url) {
                return fetch(url, {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (response) {
                    return response.json();
                })
            };

            function renderSelect(jsonData, elementId) {
                let targetSelect = document.getElementById(elementId);
                let dataSource = jsonData.unshift({ id: 0, name: "請選擇分館" });

                let options = jsonData.map(function (item) {
                    return `<option value="${item.id}">${item.name}</option>`;
                });

                targetSelect.innerHTML = options.join("");
            };
        </script>
        <script>
            var exampleModal = document.getElementById('exampleModal')
            exampleModal.addEventListener('show.bs.modal', function (event) {
                // Button that triggered the modal
                var button = event.relatedTarget
                // Extract info from data-bs-* attributes
                var recipient = button.getAttribute('data-bs-whatever')
                var roomTypeName = button.getAttribute('data-bs-roomTypeName')
                var guestNumberCapacity = button.getAttribute('data-bs-guestNumberCapacity')
                var description = button.getAttribute('data-bs-description')
                var price = button.getAttribute('data-bs-price')  

                var modalTitle = exampleModal.querySelector('.modal-title')
                var modalBodyRoomTypeName = exampleModal.querySelector('#recipient-roomTypeName')
                var modalBodyGuestNumberCapacity = exampleModal.querySelector('#recipient-guestNumberCapacity')
                var modalBodyDescription = exampleModal.querySelector('#recipient-Description')
                var modalBodyPrice = exampleModal.querySelector('#recipient-Price')

                modalTitle.textContent = recipient + "號房"
                modalBodyRoomTypeName.value = roomTypeName
                modalBodyGuestNumberCapacity.value = guestNumberCapacity
                modalBodyDescription.value = description
                modalBodyPrice.value = price

            })
        </script>
    }
